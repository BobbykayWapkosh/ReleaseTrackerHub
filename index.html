<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Release Tracker Hub</title>

<!-- Gotta grab Chart.js so we can show those cool platform charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg: #f9f9f9;
  --card: #ffffff;
  --text: #111;
  --muted: #555;
  --accent: #22c55e;
  --shadow: rgba(0,0,0,0.08);
  --border: #e5e7eb;
  --soft: #eef2f7;
}

body.dark {
  --bg: #0f172a;
  --card: #020617;
  --text: #e5e7eb;
  --muted: #9ca3af;
  --shadow: rgba(0,0,0,0.6);
  --border: #1f2937;
  --soft: #020617;
}

* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  transition: background .25s, color .25s;
}

/* Header & Wrapper */
header {
  position: sticky;
  top: 0;
  z-index: 10;
  background: var(--card);
  border-bottom: 1px solid var(--border);
}
.header-inner {
  max-width: 900px;
  margin: auto;
  padding: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.wrap { max-width: 900px; margin: auto; padding: 16px; }

/* Make the header behave nicely on phones & tablets */
@media (max-width: 480px) {
  .header-inner {
    flex-wrap: wrap;
    gap: 8px;
  }

  .header-inner h1 {
    font-size: 1.5rem;
    margin-right: 0;
  }

  .dark-toggle {
    font-size: 0.9rem;
  }
}


/* All the clickable buttons */
button {
  padding: 8px 12px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  background: var(--accent);
  color: #fff;
  transition: transform .2s ease, opacity .2s ease;
}
button:hover { opacity: .85; transform: translateY(-1px); }
.dark-toggle { background: transparent; border: 1px solid var(--border); color: var(--text); }

/* Forms Inputs */
form { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px; position: relative; }
input, select {
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--text);
  transition: border .2s ease, background .2s ease;
}
input:focus, select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(34,197,94,0.2); }

/* Duplicate Relase Warning */
.duplicate-warning {
  grid-column: 1 / -1;
  background: #fef3c7;
  color: #92400e;
  padding: 10px 12px;
  border-radius: 8px;
  border-left: 4px solid #f59e0b;
  font-size: 0.9rem;
  display: none;
  animation: slideDown 0.3s ease;
}
body.dark .duplicate-warning {
  background: #451a03;
  color: #fbbf24;
  border-left-color: #f59e0b;
}
@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Stats */
.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(140px,1fr));
  gap: 12px;
  margin-bottom: 16px;
}
.stats div {
  background: var(--soft);
  padding: 10px;
  border-radius: 10px;
  transition: transform .2s ease, box-shadow .2s ease;
}
.stats div:hover { transform: translateY(-2px); box-shadow: 0 8px 20px var(--shadow); }

/* CSV Buttons */
.csv-buttons { display: flex; gap: 8px; margin-bottom: 16px; }

/* Visual Progress Bar */
.progress-wrap { margin-bottom: 20px; }
.progress-label { font-size: .85rem; color: var(--muted); margin-bottom: 6px; }
.progress { height: 10px; background: var(--border); border-radius: 999px; overflow: hidden; }
.progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg,#22c55e,#16a34a); transition: width .3s ease; }

/* Button & Dropdown Filters */
.filters {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
  flex-wrap: wrap;
  align-items: center;
}
.filters button { background: var(--soft); color: var(--text); transition: transform .2s ease; }
.filters button.active { background: var(--accent); color: #fff; }
.filters button:hover { transform: translateY(-1px); }
.sort-date-select { padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--soft); color: var(--text); cursor: pointer; }

/* Search bar Styling*/
.search-input { padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--soft); color: var(--text); margin-bottom: 12px; width: 100%; max-width: 300px; }

/* Grid & Cards Layout */
.grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(250px,1fr)); gap: 16px; }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.card {
  background: var(--card);
  border-radius: 14px;
  padding: 14px;
  border: 1px solid var(--border);
  box-shadow: 0 6px 16px var(--shadow);
  transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
  animation: fadeInUp .3s ease both;
}
.card:hover { transform: translateY(-4px); box-shadow: 0 14px 30px var(--shadow); }
.card p { margin: 4px 0; color: var(--muted); }

/* Card Highlight (colors) Based on Date */
.card.today {
  background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
  border-color: #10b981;
}
body.dark .card.today {
  background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
  border-color: #10b981;
}

.card.tomorrow {
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border-color: #f59e0b;
}
body.dark .card.tomorrow {
  background: linear-gradient(135deg, #451a03 0%, #78350f 100%);
  border-color: #f59e0b;
}

/* Unique ID Looks */
.release-id {
  font-size: 0.7rem;
  color: var(--muted);
  opacity: 0.7;
  font-family: 'Courier New', monospace;
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px solid var(--border);
  user-select: all;
  cursor: pointer;
  transition: opacity 0.2s ease;
}
.release-id:hover {
  opacity: 1;
}
.release-id::before {
  content: "ID: ";
  font-weight: 600;
}

/* Status Badges*/
.status { display: inline-block; padding: 3px 8px; border-radius: 6px; font-size: .8rem; font-weight: 700; color: #fff; transition: transform .15s ease; }
.status.Submitted { background: #facc15; color: #111; }
.status.Live { background: #22c55e; }
.status.Rejected { background: #ef4444; }
.status.Delayed { background: #f97316; }
.card button { margin-top: 8px; font-size: .85rem; }
.edit-btn { background: #3b82f6; }
.delete-btn { background: #ef4444; }
.cancel-btn { background: #6b7280; }

/* Footer */
footer { 
  text-align: center; 
  padding: 16px; 
  color: var(--muted); 
  font-size: 0.9rem; 
}

footer .heart {
  color: #ef4444;
  transition: transform 0.3s ease, color 0.3s ease;
  display: inline-block;
}

footer .heart:hover {
  transform: scale(1.3) rotate(10deg);
  color: #f87171; 
}

/* Toasts (Popup notifications) */
.toast-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  display: flex;
  flex-direction: column-reverse;
  gap: 8px;
  z-index: 9999;
}
.toast {
  background: var(--accent);
  color: #fff;
  padding: 10px 14px;
  border-radius: 8px;
  box-shadow: 0 4px 12px var(--shadow);
  opacity: 0;
  transform: translateX(50px);
  animation: slideIn 0.5s forwards, fadeOut 0.5s 2.5s forwards;
}
.toast button {
  background: transparent;
  border: none;
  color: #fff;
  margin-left: 8px;
  cursor: pointer;
}
@keyframes slideIn { to { opacity: 1; transform: translateX(0); } }
@keyframes fadeOut { to { opacity: 0; transform: translateX(50px); } }

/* Platform analytics chart container */
.chart-wrap {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 20px;
  box-shadow: 0 6px 16px var(--shadow);
  min-height: 250px;
}
.chart-wrap h3 { margin: 0 0 10px; font-size: 1rem; }
.chart-empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  color: var(--muted);
  text-align: center;
}
.chart-empty-state svg {
  width: 64px;
  height: 64px;
  margin-bottom: 12px;
  opacity: 0.5;
}
</style>
</head>
<body>
<header>
  <div class="header-inner">
    <h1>ReleaseTrackerHub</h1>
    <button id="themeToggle" class="dark-toggle">üåë Dark</button>
  </div>
</header>
<main class="wrap">
  <form id="releaseForm">
    <div class="duplicate-warning" id="duplicateWarning">
      üò¨ Oops Similar release detected! Pls Check if this is a duplicate.
    </div>
    <input id="title" placeholder="Track Title" required />
    <input id="artist" placeholder="Artist" required />
    <input id="platform" placeholder="Platform" required />
    <input type="date" id="date" required />
    <select id="status">
      <option>Submitted</option>
      <option>Live</option>
      <option>Rejected</option>
      <option>Delayed</option>
    </select>
    <button>Add Release</button>
  </form>

  <div class="stats" id="statsBar"></div>

  <div class="progress-wrap">
    <div class="progress-label" id="progressLabel">Progress: 0% Live</div>
    <div class="progress">
      <div class="progress-bar" id="progressBar"></div>
    </div>
  </div>

  <div class="chart-wrap">
    <h3><svg width="17px" height="17px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path opacity="0.5" d="M3 22H21" stroke="#22c55e" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M3 11C3 10.0572 3 9.58579 3.29289 9.29289C3.58579 9 4.05719 9 5 9C5.94281 9 6.41421 9 6.70711 9.29289C7 9.58579 7 10.0572 7 11V17C7 17.9428 7 18.4142 6.70711 18.7071C6.41421 19 5.94281 19 5 19C4.05719 19 3.58579 19 3.29289 18.7071C3 18.4142 3 17.9428 3 17V11Z" stroke="#22c55e" stroke-width="1.5"></path> <path d="M10 7C10 6.05719 10 5.58579 10.2929 5.29289C10.5858 5 11.0572 5 12 5C12.9428 5 13.4142 5 13.7071 5.29289C14 5.58579 14 6.05719 14 7V17C14 17.9428 14 18.4142 13.7071 18.7071C13.4142 19 12.9428 19 12 19C11.0572 19 10.5858 19 10.2929 18.7071C10 18.4142 10 17.9428 10 17V7Z" stroke="#22c55e" stroke-width="1.5"></path> <path d="M17 4C17 3.05719 17 2.58579 17.2929 2.29289C17.5858 2 18.0572 2 19 2C19.9428 2 20.4142 2 20.7071 2.29289C21 2.58579 21 3.05719 21 4V17C21 17.9428 21 18.4142 20.7071 18.7071C20.4142 19 19.9428 19 19 19C18.0572 19 17.5858 19 17.2929 18.7071C17 18.4142 17 17.9428 17 17V4Z" stroke="#22c55e" stroke-width="1.5"></path> </g></svg> Platform Analytics</h3>
    <div id="chartContainer">
      <canvas id="platformChart" height="180"></canvas>
    </div>
  </div>

  <div class="csv-buttons">
    <button type="button" id="exportCSV">Download Stats (CSV)</button>
    <button type="button" id="importCSV">Import Stats</button>
    <input type="file" id="csvFileInput" accept=".csv" style="display:none;">
  </div>

  <!-- Search Bar Input -->
  <input type="text" id="searchInput" class="search-input" placeholder="Search by Title, Artist, Platform, or ID">

  <div class="filters">
    <button data-filter="All" class="active">All</button>
    <button data-filter="Submitted">Submitted</button>
    <button data-filter="Live">Live</button>
    <button data-filter="Rejected">Rejected</button>
    <button data-filter="Delayed">Delayed</button>
    <select id="sortDate" class="sort-date-select">
      <option value="">Sort by Date</option>
      <option value="older">Older</option>
      <option value="newer">Newer</option>
    </select>
  </div>

  <div id="grid" class="grid"></div>
</main>
<footer>
  Crafted with <span class="heart">‚ù§</span> by <strong><a href="https://lifeofbobbykay.name.ng"><font color="#22c55e">BobbyKay</font></a></strong> for <strong>Wapkosh Tech</strong>
</footer>

<!-- Toast Notifications Container -->
<div class="toast-container" id="toastContainer"></div>

<script>
const form=document.getElementById('releaseForm');
const grid=document.getElementById('grid');
const filters=document.querySelectorAll('.filters button');
const statsBar=document.getElementById('statsBar');
const progressBar=document.getElementById('progressBar');
const progressLabel=document.getElementById('progressLabel');
const themeToggle=document.getElementById('themeToggle');
const exportCSV=document.getElementById('exportCSV');
const importCSV=document.getElementById('importCSV');
const csvFileInput=document.getElementById('csvFileInput');
const sortDate=document.getElementById('sortDate');
const searchInput=document.getElementById('searchInput');
const toastContainer=document.getElementById('toastContainer');
const duplicateWarning=document.getElementById('duplicateWarning');
const platformChartCanvas=document.getElementById('platformChart');
const chartContainer=document.getElementById('chartContainer');

// Generate a unique ID for each release (Date + random string)
function generateUniqueID() {
  return Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

let releases=JSON.parse(localStorage.getItem('releases'))||[];
let deletedReleases=[];
let currentFilter='All';
let currentSearch='';

// Check existing releases then assign IDs if they‚Äôre missing
let needsMigration = false;
releases.forEach(release => {
  if (!release.id) {
    release.id = generateUniqueID();
    needsMigration = true;
  }
});
if (needsMigration) {
  localStorage.setItem('releases', JSON.stringify(releases));
  console.log('‚úÖ Auto-generated IDs for existing releases');
}

// Map each streaming platform to a consistent color for the charts
const platformColors={};
const colorPalette=[
  '#22c55e', 
  '#3b82f6', 
  '#f59e0b', 
  '#ef4444', 
  '#8b5cf6', 
  '#ec4899', 
  '#06b6d4', 
  '#f97316', 
  '#10b981', 
  '#6366f1', 
  '#14b8a6', 
  '#f43f5e'  
];

function getPlatformColor(platform){
  if(!platformColors[platform]){
    const usedColors=Object.values(platformColors);
    const availableColors=colorPalette.filter(c=>!usedColors.includes(c));
    platformColors[platform]=availableColors.length>0?availableColors[0]:colorPalette[Object.keys(platformColors).length%colorPalette.length];
  }
  return platformColors[platform];
}

// Toast helper
function showToast(message){
  const toast=document.createElement('div');
  toast.className='toast';
  toast.textContent=message;
  toastContainer.appendChild(toast);
  setTimeout(()=>toast.remove(),3000);
}

// Undo toast
function showUndoToast(message, release){
  const toast=document.createElement('div');
  toast.className='toast';
  toast.innerHTML=`${message} <button>Undo</button>`;
  toastContainer.appendChild(toast);
  const undoBtn=toast.querySelector('button');

  const timeout=setTimeout(()=>{
    deletedReleases=deletedReleases.filter(r=>r!==release);
    toast.remove();
  },7000);

  undoBtn.onclick=()=>{
    releases.push(release);
    deletedReleases=deletedReleases.filter(r=>r!==release);
    save();
    render();
    toast.remove();
    showToast(`"${release.title}" restored`);
    clearTimeout(timeout);
  }
}

function save(){localStorage.setItem('releases',JSON.stringify(releases));}

// Helper function to check for duplicated releases
function isDuplicate(title, artist, platform, excludeRelease = null) {
  return releases.some(r =>
    r !== excludeRelease &&
    r.title.toLowerCase() === title.toLowerCase() &&
    r.artist.toLowerCase() === artist.toLowerCase() &&
    r.platform.toLowerCase() === platform.toLowerCase()
  );
}

function updateStats(){
  const total=releases.length;
  const submitted=releases.filter(r=>r.status==='Submitted').length;
  const live=releases.filter(r=>r.status==='Live').length;
  const rejected=releases.filter(r=>r.status==='Rejected').length;
  const delayed=releases.filter(r=>r.status==='Delayed').length;
  const progress=total?Math.round((live/total)*100):0;
  statsBar.innerHTML=`<div>Total: ${total}</div><div>Submitted: ${submitted}</div><div>Live: ${live}</div><div>Rejected: ${rejected}</div><div>Delayed: ${delayed}</div>`;
  progressBar.style.width=progress+'%';
  progressLabel.textContent=`Progress: ${progress}% Live`;
}

// Initialize Chart.js with custom options and animations
let platformChart;

function getPlatformStats(){
  const counts={};
  releases.forEach(r=>{
    const platform=r.platform;
    counts[platform]=(counts[platform]||0)+1;
  });
  return counts;
}

function renderPlatformChart(){
  const dataObj=getPlatformStats();
  const labels=Object.keys(dataObj);
  const data=Object.values(dataObj);
  const isDark=document.body.classList.contains('dark');

  // Show empty state if no data is inputed
  if(labels.length===0){
    chartContainer.innerHTML=`
      <div class="chart-empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
        </svg>
        <p>Please Add releases to see each platform analytics</p>
      </div>
    `;
    return;
  }

  // Restore canvas if it was replaced by empty state
  if(!chartContainer.querySelector('canvas')){
    chartContainer.innerHTML='<canvas id="platformChart" height="180"></canvas>';
  }

  const canvas=document.getElementById('platformChart');
  
  if(platformChart) platformChart.destroy();

  // Generate an array of colors to use for each platform in chart
  const backgroundColors=labels.map(label=>getPlatformColor(label));

  platformChart=new Chart(canvas,{
    type:'bar',
    data:{
      labels,
      datasets:[{
        label:'Releases',
        data,
        borderRadius:10,
        backgroundColor:backgroundColors,
        borderWidth:0,
        hoverBackgroundColor:backgroundColors.map(c=>c+'dd')
      }]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      animation:{
        duration:800,
        easing:'easeInOutQuart'
      },
      plugins:{
        legend:{display:false},
        tooltip:{
          enabled:true,
          backgroundColor:isDark?'#1f2937':'#ffffff',
          titleColor:isDark?'#e5e7eb':'#111',
          bodyColor:isDark?'#e5e7eb':'#111',
          borderColor:isDark?'#374151':'#e5e7eb',
          borderWidth:1,
          padding:12,
          displayColors:true,
          callbacks:{
            label:function(context){
              return `  ${context.parsed.y} release${context.parsed.y!==1?'s':''}`;
            }
          }
        }
      },
      scales:{
        x:{
          ticks:{color:isDark?'#e5e7eb':'#111',font:{size:11}},
          grid:{display:false}
        },
        y:{
          beginAtZero:true,
          ticks:{
            color:isDark?'#e5e7eb':'#111',
            precision:0,
            font:{size:11}
          },
          grid:{color:isDark?'#1f2937':'#e5e7eb'}
        }
      }
    }
  });
}

// Get date category for card highlighting
function getDateCategory(dateStr){
  const today=new Date();
  today.setHours(0,0,0,0);
  const releaseDate=new Date(dateStr);
  releaseDate.setHours(0,0,0,0);
  const tomorrow=new Date(today);
  tomorrow.setDate(tomorrow.getDate()+1);
  if(releaseDate.getTime()===today.getTime()) return 'today';
  if(releaseDate.getTime()===tomorrow.getTime()) return 'tomorrow';
  return 'normal';
}

function render(){
  grid.innerHTML='';
  let filtered=releases.filter(r=>currentFilter==='All'||r.status===currentFilter);

  if(currentSearch){
    filtered=filtered.filter(r=>
      r.title.toLowerCase().includes(currentSearch)||
      r.artist.toLowerCase().includes(currentSearch)||
      r.platform.toLowerCase().includes(currentSearch)||
      (r.id && r.id.toLowerCase().includes(currentSearch))
    );
  }

  if(sortDate.value==='older') filtered.sort((a,b)=>new Date(a.date)-new Date(b.date));
  if(sortDate.value==='newer') filtered.sort((a,b)=>new Date(b.date)-new Date(a.date));

  if(!filtered.length){
    grid.innerHTML=`<div class="empty-state">No releases found.<br><button onclick="document.getElementById('title').focus()">Add your first release</button></div>`;
  }

  filtered.forEach((r,i)=>{
    const card=document.createElement('div');
    const dateCategory=getDateCategory(r.date);
    card.className=`card ${dateCategory}`;
    card.innerHTML=`
      <h3>${r.title}</h3>
      <p>Artist: ${r.artist}</p>
      <p>Platform: ${r.platform}</p>
      <p>Release Date: ${r.date}</p>
      <select class="status-select">
        <option ${r.status==='Submitted'?'selected':''}>Submitted</option>
        <option ${r.status==='Live'?'selected':''}>Live</option>
        <option ${r.status==='Rejected'?'selected':''}>Rejected</option>
        <option ${r.status==='Delayed'?'selected':''}>Delayed</option>
      </select>
      <div>
        <button class="edit-btn">Edit</button>
        <button class="delete-btn">Delete</button>
      </div>
      <div class="release-id" title="Click to copy ID">${r.id}</div>
    `;
    
    // Copy the release's unique ID to the clipboard when clicked
    const idElement = card.querySelector('.release-id');
    idElement.onclick = () => {
      navigator.clipboard.writeText(r.id).then(() => {
        showToast(' ID copied to clipboard!');
      }).catch(() => {
        showToast(' Could&#39;t copy ID');
      });
    };
    
    const statusSelect=card.querySelector('.status-select');
    statusSelect.onchange=()=>{
      r.status=statusSelect.value;
      save();
      updateStats();
      renderPlatformChart();
      card.style.transform='scale(1.03)';
      setTimeout(()=>card.style.transform='scale(1)',200);
      showToast(`Status changed to "${r.status}"`);
    };

    card.querySelector('.delete-btn').onclick=()=>{
      const removed=releases.splice(releases.indexOf(r),1)[0];
      deletedReleases.push(removed);
      save();
      render();
      showUndoToast(`"${removed.title}" deleted`, removed);
    };

    const editBtn=card.querySelector('.edit-btn');
    const buttonContainer=card.querySelector('div');
    
    editBtn.onclick=()=>{
      if(editBtn.textContent==='Edit'){
        // Keep track of the original values so we can cancel edits if needed
        const originalTitle=r.title;
        const originalArtist=r.artist;
        const originalPlatform=r.platform;
        const originalDate=r.date;
        
        // Switch the card into edit mode
        card.querySelector('h3').innerHTML=`<input value="${r.title}">`;
        card.querySelectorAll('p')[0].innerHTML=`Artist: <input value="${r.artist}">`;
        card.querySelectorAll('p')[1].innerHTML=`Platform: <input value="${r.platform}">`;
        card.querySelectorAll('p')[2].innerHTML=`Release Date: <input type="date" value="${r.date}">`;
        editBtn.textContent='Save';
        
       // Add a Cancel button to allow discarding edits
        const cancelBtn=document.createElement('button');
        cancelBtn.textContent='Cancel';
        cancelBtn.className='cancel-btn';
        cancelBtn.onclick=(e)=>{
          e.stopPropagation();
          // Restore original values
          card.querySelector('h3').textContent=originalTitle;
          card.querySelectorAll('p')[0].textContent=`Artist: ${originalArtist}`;
          card.querySelectorAll('p')[1].textContent=`Platform: ${originalPlatform}`;
          card.querySelectorAll('p')[2].textContent=`Release Date: ${originalDate}`;
          editBtn.textContent='Edit';
          cancelBtn.remove();
          showToast('Edit cancelled');
        };
        buttonContainer.insertBefore(cancelBtn, card.querySelector('.delete-btn'));
        
      }else{
        const inputs=card.querySelectorAll('input');
        const newTitle=inputs[0].value.trim();
        const newArtist=inputs[1].value.trim();
        const newPlatform=inputs[2].value.trim();
        const newDate=inputs[3].value;
        
        // Check if editing would create a duplicate with OTHER releases
        if(isDuplicate(newTitle, newArtist, newPlatform, r)){
          showToast('Oops Cannot save - this would create a duplicate!');
          // Keep edit mode open so user can fix it
          return;
        }
        
        // No duplicate, proceed with save
        r.title=newTitle;
        r.artist=newArtist;
        r.platform=newPlatform;
        r.date=newDate;
        save();
        render();
        showToast(`"${r.title}" updated`);
      }
    }

    grid.appendChild(card);
  });
  updateStats();
  renderPlatformChart();
}

// Duplicate check for form warning
function checkDuplicate(){
  const title=form.title.value.trim();
  const artist=form.artist.value.trim();
  const platform=form.platform.value.trim();
  if(!title && !artist && !platform){
    duplicateWarning.style.display='none';
    return;
  }
  duplicateWarning.style.display=isDuplicate(title, artist, platform)?'block':'none';
}

form.title.addEventListener('input', checkDuplicate);
form.artist.addEventListener('input', checkDuplicate);
form.platform.addEventListener('input', checkDuplicate);

form.onsubmit=e=>{
  e.preventDefault();
  const newRelease={
    id: generateUniqueID(),
    title:form.title.value.trim(),
    artist:form.artist.value.trim(),
    platform:form.platform.value.trim(),
    date:form.date.value,
    status:form.status.value
  };
  if(isDuplicate(newRelease.title, newRelease.artist, newRelease.platform)){
    showToast('Duplicated release not added!');
    return;
  }
  releases.push(newRelease);
  save();
  render();
  form.reset();
  duplicateWarning.style.display='none';
  showToast(`"${newRelease.title}" added`);
};

// Filters
filters.forEach(btn=>{
  btn.onclick=()=>{
    filters.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentFilter=btn.dataset.filter;
    render();
  };
});

// Sort
sortDate.onchange=()=>{ render(); };

// Search
searchInput.oninput=e=>{
  currentSearch=e.target.value.toLowerCase();
  render();
};

// Dark mode toggle
themeToggle.onclick=()=>{
  document.body.classList.toggle('dark');
  const isDark=document.body.classList.contains('dark');
  themeToggle.textContent=isDark?'‚òÄÔ∏è Light':'üåë Dark';
  localStorage.setItem('theme',isDark?'dark':'light');
  renderPlatformChart();
};
if(localStorage.getItem('theme')==='dark'){
  document.body.classList.add('dark');
  themeToggle.textContent='‚òÄÔ∏è Light';
}

// CSV Function
function downloadCSV(data, filename='releases.csv'){
  const csvRows=[];
  const headers=['ID','Title','Artist','Platform','Date','Status'];
  csvRows.push(headers.join(','));
  data.forEach(r=>{
    const row=[r.id,r.title,r.artist,r.platform,r.date,r.status].map(v=>`"${v.replace(/"/g,'""')}"`).join(',');
    csvRows.push(row);
  });
  const blob=new Blob([csvRows.join('\n')],{type:'text/csv'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');a.href=url;a.download=filename;a.click();URL.revokeObjectURL(url);
}
exportCSV.onclick=()=>downloadCSV(releases);

importCSV.onclick=()=>csvFileInput.click();
csvFileInput.onchange=(e)=>{
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=evt=>{
    const text=evt.target.result;
    const lines=text.split('\n').filter(line=>line.trim()!=='');
    const [header,...rows]=lines;
    const newReleases=rows.map(row=>{
      const values=row.split(',').map(v=>v.replace(/^"|"$/g,'').replace(/""/g,'"'));
      
      // Check if CSV has ID column (new format) or not (old format)
      const hasIDColumn = header.toLowerCase().includes('id');
      
      if(hasIDColumn && values.length >= 6) {
        // New format: ID,Title,Artist,Platform,Date,Status
        return {
          id: values[0],
          title: values[1],
          artist: values[2],
          platform: values[3],
          date: values[4],
          status: values[5]
        };
      } else {
        // Old format: Title,Artist,Platform,Date,Status & generate new ID
        return {
          id: generateUniqueID(),
          title: values[0],
          artist: values[1],
          platform: values[2],
          date: values[3],
          status: values[4]
        };
      }
    });
    
    let importedCount=0;
    let skippedCount=0;
    
    newReleases.forEach(r=>{
      if(!isDuplicate(r.title, r.artist, r.platform)){
        releases.push(r);
        importedCount++;
      }else{
        skippedCount++;
      }
    });
    
    save();
    render();
    
    // Show detailed feedback
    if(importedCount>0 && skippedCount>0){
      showToast(` Imported! ${importedCount} release(s), skipped ${skippedCount} duplicate(s)`);
    }else if(importedCount>0){
      showToast(` Imported! ${importedCount} release(s)`);
    }else if(skippedCount>0){
      showToast(`All ${skippedCount} release(s) were duplicates: Nothing imported`);
    }else{
      showToast('No releases found in CSV');
    }
  };
  reader.readAsText(file);
  csvFileInput.value='';
};

render();
</script>
</body>
</html>